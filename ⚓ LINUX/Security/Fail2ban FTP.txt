Fail2ban Защита FTP сервера 

* Настройка Fail2Ban для мониторинга журналов FTP сервера
* Здесь описаны все необходимые фильтры для FTP сервера

[proftpd]     - Защита proFTPd сервера
[vsftpd]      - Защита vsFTPd сервера
[pure-ftpd]   - Защита Pure-FTPd сервера


Важно! Следите за тем, чтобы путь к файлу хранения логов logpath был указан корректно. 
Обязательно назначьте ему необходимые права доступа командой chmod 755 /var/log/XXX.log
* У вас должны быть определены базовые параметры [DEFAULT] в jail.local


*** Конфигурация Fail2ban настраивается

--- $ nano /etc/fail2ban/jail.local

*** Управление активными фильтрами

--- $ cd /etc/fail2ban/filter.d


*** Выставить защиту вашего FTP сервера - перед настройкой вы должны учесть, какой из FTP вы используте (vsFTPd, proFTPd, Pure-FTPd), настройки могут отличаться. 


*** Защита proFTPd

--- jail.local --------------------------------------------------------------------
-----------------------------------------------------------------------------------
[proftpd]

enabled = true
port    = ftp,ftp-data,ftps,ftps-data
filter  = proftpd
logpath = /var/log/proftpd.log
-----------------------------------------------------------------------------------
--- proftpd.conf ------------------------------------------------------------------
-----------------------------------------------------------------------------------
Фильтр proftpd.conf существует по умолчанию в фильтрах
-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------


*** Защита vsFTPd

--- jail.local --------------------------------------------------------------------
-----------------------------------------------------------------------------------
[vsftpd]

enabled = true
port    = ftp,ftp-data,ftps,ftps-data
filter  = vsftpd
logpath = /var/log/vsftpd.log
-----------------------------------------------------------------------------------
--- vsftpd.conf -------------------------------------------------------------------
-----------------------------------------------------------------------------------
Фильтр vsftpd.conf существует по умолчанию в фильтрах
-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------


*** Защита Pure-FTPd

--- jail.local --------------------------------------------------------------------
-----------------------------------------------------------------------------------
[pure-ftpd]

enabled = true
port    = ftp,ftp-data,ftps,ftps-data
filter  = pure-ftpd
logpath = /var/log/messages
-----------------------------------------------------------------------------------
--- vsftpd.conf ------------------------------------------------------------------
-----------------------------------------------------------------------------------
Фильтр vsftpd.conf существует по умолчанию в фильтрах
-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------



--- Проверка срабатывания правил --------------------------------------------------------
-----------------------------------------------------------------------------------------
*** Проверка срабатывания правил
--- $ fail2ban-regex /var/log/ХХХ.log /etc/fail2ban/filter.d/ХХХ.conf

*** В случае проблем, логи можно посмотреть следующим образом
--- $ tail -F /var/log/fail2ban.log
--- $ Cntr + Z выйти

*** После внесения изменений в jail.local
* Проверить состояние fail2ban
--- $ systemctl status fail2ban
* Перезапустить сервис
--- $ service fail2ban restart
* Получение информации о включенных джейлах
--- $ fail2ban-client status

